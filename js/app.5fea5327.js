(function(t){function e(e){for(var r,i,s=e[0],l=e[1],c=e[2],f=0,h=[];f<s.length;f++)i=s[f],o[i]&&h.push(o[i][0]),o[i]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(t[r]=l[r]);u&&u(e);while(h.length)h.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],r=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(r=!1)}r&&(a.splice(e--,1),t=i(i.s=n[0]))}return t}var r={},o={app:0},a=[];function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/abstract-blockchain/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var r=n("64a9"),o=n.n(r);o.a},1:function(t,e){},1052:function(t,e,n){},"121b":function(t,e,n){},2:function(t,e){},3:function(t,e){},"36c9":function(t,e,n){"use strict";var r=n("121b"),o=n.n(r);o.a},4:function(t,e){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var r=n("2b0e"),o=n("5c96"),a=n.n(o),i=(n("0fae"),n("28bd")),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-container",{attrs:{id:"app"}},[n("el-header",{attrs:{height:"auto"}},[n("div",{staticClass:"description"},[n("h3",[t._v("\n                To connect two browsers\n            ")]),n("p",[t._v("Visit index.html#1 from one browser (the initiator) and index.html from another browser (the receiver).")]),n("p",[t._v('An "offer" will be generated by the initiator. Paste this into the receiver\'s form and hit submit. The receiver generates an "answer". Paste this into the initiator\'s form and hit submit.')]),n("p",[t._v("Now you have a direct P2P connection between two browsers!")])])]),n("el-main",[t._l(t.wallets,function(e,r){return n("p",{key:r,staticClass:"wallet"},[t._v("\n            Wallet : "+t._s(e.getPublic("hex"))+"\n        ")])}),n("p",{staticClass:"difficulty"},[t._v("Difficulty: "+t._s(t.chain.difficulty))]),n("client-node",{attrs:{wallet:t.myWallet,chain:t.chain},on:{mine:t.onMine}}),n("chain-table",{attrs:{chain:t.chain}})],2)],1)},l=[],c=(n("ac4d"),n("8a81"),n("ac6a"),n("96cf"),n("1da1")),u=n("d4ec"),f=n("bee2"),h=(n("14b9"),n("f559"),n("6b54"),n("7409")),d=n.n(h),m=n("3452"),p=n.n(m),v=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();Object(u["a"])(this,t),this.previousHash=n,this.hash=this.calculateHash(),this.nonce=d()(0),this.timestamp=r,this.transactions=e}return Object(f["a"])(t,[{key:"calculateHash",value:function(){return p.a.SHA3(JSON.stringify(this.transactions)+this.timestamp+this.previousHash+this.nonce).toString()}},{key:"addTransaction",value:function(t){if(!t.isValid)throw new Error("Invalid transaction");this.transactions.push(t)}},{key:"mineBlock",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){while(!n.hash.startsWith("0".repeat(e)))n.nonce+=d()(1),n.nonce%5e3===0&&console.log(n.nonce),n.hash=n.calculateHash();return t(n.hash)}));case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"hasValidTransactions",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,o=this.transactions[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;if(!a.isValid())return!1}}catch(i){e=!0,n=i}finally{try{t||null==o.return||o.return()}finally{if(e)throw n}}return!1}}]),t}(),b=1e3,g=function(){function t(){Object(u["a"])(this,t),this.blocks=[this.createGenesisBlock()],this.difficulty=2}return Object(f["a"])(t,[{key:"createGenesisBlock",value:function(){return new v(null,null,Date.now())}},{key:"getPreviousBlock",value:function(){return this.blocks[this.blocks.length-1]}},{key:"mineAndAddBlock",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n,r,o,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=performance.now(),r=new v,e.forEach(function(t){r.addTransaction(t)}),o=this.getPreviousBlock(),r.previousHash=o.hash,t.abrupt("return",r.mineBlock(this.difficulty).then(function(){var t=performance.now(),e=t-n;return console.log({time:e,difficulty:a.difficulty}),e<b?a.difficulty+=1:a.difficulty-=1,a.blocks.push(r),a.blocks}));case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"isValid",value:function(){for(var t=0;t<this.block.length;t++){var e=this.block[t],n=this.block[t-1];if(e.hash!==e.calculateHash())return!1;if(e.previousHash!==n.hash)return!1}return!0}},{key:"getAddressBalance",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.blocks.length,n=0,r=1;r<=e;r++){var o=!0,a=!1,i=void 0;try{for(var s,l=this.blocks[r].transactions[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;c.from===t&&(n-=c.amount),c.to===t&&(n+=c.amount)}}catch(u){a=!0,i=u}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}}return n}}]),t}(),w=n("b9a8"),y=n.n(w),k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h2",[t._v("Your Wallet:")]),n("el-form",{ref:"transactionForm",staticClass:"form-inline",attrs:{"label-position":"right",rules:t.rules,"label-width":"200px",model:t.transactionForm}},[n("el-form-item",{attrs:{label:"From address",prop:"from"}},[n("el-input",{attrs:{disabled:"",placeholder:"from walet address"},model:{value:t.transactionForm.from,callback:function(e){t.$set(t.transactionForm,"from",e)},expression:"transactionForm.from"}})],1),n("el-form-item",{attrs:{label:"To address",prop:"to"}},[n("el-input",{attrs:{placeholder:"to walet address"},model:{value:t.transactionForm.to,callback:function(e){t.$set(t.transactionForm,"to",e)},expression:"transactionForm.to"}})],1),n("el-form-item",{attrs:{label:"Amount",prop:"amount"}},[n("el-input-number",{attrs:{min:0,step:.1},model:{value:t.transactionForm.amount,callback:function(e){t.$set(t.transactionForm,"amount",e)},expression:"transactionForm.amount"}})],1),n("el-form-item",[n("el-button",{attrs:{disabled:t.isMining,type:"primary"},on:{click:function(e){t.submitForm("transactionForm")}}},[t._v("Send")]),n("el-button",{on:{click:function(e){t.resetForm("transactionForm")}}},[t._v("Reset")])],1)],1),n("el-form",{ref:"connectForm",staticClass:"form-inline",attrs:{"label-position":"right","label-width":"200px",model:t.connectForm}},[n("el-form-item",{attrs:{label:"From address",prop:"from"}},[n("el-input",{attrs:{type:"textarea",rows:2},model:{value:t.connectForm.incoming,callback:function(e){t.$set(t.connectForm,"incoming",e)},expression:"connectForm.incoming"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitConnectForm("connectForm")}}},[t._v("Connect")]),n("el-button",{on:{click:function(e){t.resetForm("connectForm")}}},[t._v("Reset")])],1)],1)],1)},_=[],S=function(){function t(e){var n=e.from,r=e.to,o=e.amount,a=e.signature;Object(u["a"])(this,t),this.from=n,this.to=r,this.amount=o,this.signature=a}return Object(f["a"])(t,[{key:"calculateHash",value:function(){return p.a.SHA3(this.from+this.to+this.amount).toString()}},{key:"sign",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,r){e.getPublic("hex")!==n.from&&r("You can not sign transaction from another wallet");var o=n.calculateHash(),a=e.sign(o,"hex");return n.signature=a.toDER("hex"),t(n.signature)}));case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"isValid",value:function(){if(!this.signature||0===this.signature.length)throw new Error("No signature in this transaction");var t=new y.a("secp256k1"),e=t.keyFromPublic(this.from,"hex");return e.verify(this.calculateHash(),this.signature)}}]),t}(),F=new y.a("secp256k1"),P=function(){function t(e){Object(u["a"])(this,t),this.chain=e,this.myWallet=F.genKeyPair()}return Object(f["a"])(t,[{key:"publicKey",value:function(){return this.myWallet.getPublic("hex")}},{key:"wallet",value:function(){return this.myWallet}}]),t}(),O=n("051a"),x=n.n(O),j={name:"node",props:{chain:{type:Object,required:!0}},data:function(){return{worldState:{},peer:{},node:{},isMining:!1,transactionForm:{from:"",to:"",amount:0},connectForm:{incoming:""},rules:{from:[{required:!0,message:"Please input From address",trigger:"blur"}],to:[{required:!0,message:"Please input To address",trigger:"blur"}],amount:[{required:!0,message:"Please input Amount",trigger:"change"}]}}},created:function(){this.node=new P(this.chain),this.transactionForm.from=this.node.publicKey(),this.initPeer()},methods:{initPeer:function(){this.peer=new x.a({initiator:"#1"===location.hash,trickle:!1}),this.peer.on("error",this.onPeerError),this.peer.on("signal",this.onPeerSignal),this.peer.on("connect",this.onPeerConnect),this.peer.on("data",this.onPeerData)},onPeerError:function(t){console.log("peer error",t)},onPeerSignal:function(t){console.log("SIGNAL",JSON.stringify(t))},onPeerConnect:function(){console.log("CONNECT")},onPeerData:function(t){var e=this;console.log("data: "+t);var n=new S(JSON.parse(t));this.isMining=!0,this.node.chain.mineAndAddBlock([n]).then(function(t){console.log("blocks",t),e.isMining=!1,e.updateWorldState(t[t.length-1])})},updateWorldState:function(t){console.log(t);var e=t.transactions;console.log(t.transactions);for(var n=0;n<e.length;n++){console.log(e[n]);var r=e[n],o=r.from,a=r.to,i=r.amount;this.worldState[o]?this.worldState[o]-=i:this.worldState[o]=-i,this.worldState[a]?this.worldState[a]+=i:this.worldState[a]=+i}},submitForm:function(t){var e=this;this.isMining=!0,this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;var n=new S(JSON.parse(JSON.stringify(e.transactionForm)));n.sign(e.node.wallet()).then(function(){e.peer.send(JSON.stringify(n)),e.node.chain.mineAndAddBlock([n]).then(function(t){console.log("blocks",t),e.isMining=!1,e.updateWorldState(t[t.length-1])})}).catch(function(t){console.log("submit",t),e.isMining=!1,e.$message.error(t)})})},submitConnectForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;e.peer.signal(JSON.parse(e.connectForm.incoming))})},resetForm:function(t){this.$refs[t].resetFields()}}},C=j,A=(n("6c74"),n("2877")),W=Object(A["a"])(C,k,_,!1,null,null,null);W.options.__file="Node.vue";var B=W.exports,T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.chain.blocks,"default-sort":{prop:"date",order:"descending"}}},[n("el-table-column",{attrs:{sortable:"",label:"Date"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                "+t._s(new Date(e.row.timestamp).toGMTString())+"\n            ")])]}}])}),n("el-table-column",{attrs:{label:"From"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.transactions?[n("el-popover",{attrs:{trigger:"click",placement:"top"},on:{show:function(n){t.handlePopoverShow(e.row.transactions[0].from,e.$index)}}},[n("p",[t._v("Wallet balance: "+t._s(t.walletBalance))]),n("div",{staticClass:"name-wrapper address from",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                        "+t._s(e.row.transactions[0].from)+"\n                    ")])])]:[n("div",{staticClass:"name-wrapper address from",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                    ---\n                ")])]]}}])}),n("el-table-column",{attrs:{label:"To"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.transactions?[n("el-popover",{attrs:{trigger:"click",placement:"top"},on:{show:function(n){t.handlePopoverShow(e.row.transactions[0].to,e.$index)}}},[n("p",[t._v("Wallet balance: "+t._s(t.walletBalance))]),n("div",{staticClass:"name-wrapper address from",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                        "+t._s(e.row.transactions[0].to)+"\n                    ")])])]:[n("div",{staticClass:"name-wrapper address from",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                    ---\n                ")])]]}}])}),n("el-table-column",{attrs:{label:"Amount"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                "+t._s(e.row.transactions?e.row.transactions[0].amount:"---")+"\n            ")])]}}])})],1)},M=[],$={name:"chain-table",props:{chain:{type:Object,required:!0}},data:function(){return{walletBalance:0}},methods:{handlePopoverShow:function(t,e){this.walletBalance=this.chain.getAddressBalance(t,e)}}},H=$,N=(n("36c9"),Object(A["a"])(H,T,M,!1,null,null,null));N.options.__file="ChainTable.vue";var E=N.exports,J=new y.a("secp256k1"),R={name:"app",data:function(){return{myWallet:{},wallets:[],chain:{}}},components:{"client-node":B,ChainTable:E},created:function(){this.chain=new g,this.generateWallet(),this.generateWallet()},methods:{generateWallet:function(){var t=J.genKeyPair();this.wallets.push(t)},onMine:function(){}}},D=R,V=(n("034f"),Object(A["a"])(D,s,l,!1,null,null,null));V.options.__file="App.vue";var q=V.exports;r["default"].use(a.a),r["default"].use(i["a"]),r["default"].config.productionTip=!1,new r["default"]({render:function(t){return t(q)}}).$mount("#app")},"64a9":function(t,e,n){},"6c74":function(t,e,n){"use strict";var r=n("1052"),o=n.n(r);o.a}});
//# sourceMappingURL=app.5fea5327.js.map